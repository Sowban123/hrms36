{% extends "base.html" %}
{% block content %}

<div class="d-flex justify-content-between align-items-center mb-3">
  <span class="fw-semibold fs-5">Assign / Change Manager</span>
  <a href="{{ request.META.HTTP_REFERER|default:'/dashboard/' }}" class="btn btn-outline-dark btn-sm">â† Back</a>
</div>

<h3 class="fw-bold mb-4">Manage Departments & Managers</h3>

{% if messages %}
  {% for message in messages %}
    <div class="alert alert-{{ message.tags }} mb-2">{{ message }}</div>
  {% endfor %}
{% endif %}

<table class="table table-bordered table-striped align-middle">
  <thead>
    <tr>
      <th style="width: 20%;">Department</th>
      <th style="width: 25%;">Current Manager</th>
      <th style="width: 35%;">Assign / Change Manager</th>
      <th style="width: 20%;">Action</th>
    </tr>
  </thead>
  <tbody>
    {% for dept in departments %}
    <tr>
      <td>{{ dept.name }}</td>
      <td>
        {% if dept.manager %}
          {{ dept.manager.user.get_full_name|default:dept.manager.user.username }}
        {% else %}
          <span class="text-muted">No manager assigned</span>
        {% endif %}
      </td>
      <td>
        <form method="POST" class="d-flex gap-2">
          {% csrf_token %}
          <input type="hidden" name="department_id" value="{{ dept.id }}">

          <select name="manager_id" class="form-select">
            <option value="">-- No Manager --</option>
            {% for emp in dept.employee_set.all %}
              <option value="{{ emp.id }}"
                {% if dept.manager and dept.manager.id == emp.id %}selected{% endif %}>
                {{ emp.user.get_full_name|default:emp.user.username }}
              </option>
            {% endfor %}
          </select>
      </td>
      <td>
          <button class="btn btn-sm btn-primary">Save</button>
        </form>
      </td>
    </tr>
    {% empty %}
    <tr>
      <td colspan="4" class="text-center">No departments found.</td>
    </tr>
    {% endfor %}
  </tbody>
</table>

{% endblock %}
    