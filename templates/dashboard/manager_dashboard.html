{% extends "base.html" %}
{% block content %}

<div class="d-flex justify-content-between align-items-center mb-3">
  <span class="fw-semibold fs-5">Manager Dashboard</span>
  <a href="{{ request.META.HTTP_REFERER|default:'/dashboard/' }}" class="btn btn-outline-dark btn-sm">← Back</a>
</div>

<h3 class="fw-bold mb-4">Manager Dashboard</h3>

<!-- Manager Profile Card -->
<div class="card shadow-sm p-3 mb-4">
  <div class="d-flex align-items-center gap-4">
    {% if profile.photo %}
      <img src="{{ profile.photo.url }}" class="rounded-circle border"
           style="width:100px; height:100px; object-fit:cover;">
    {% else %}
      <img src="https://via.placeholder.com/100" class="rounded-circle border">
    {% endif %}

    <div>
      <h5 class="fw-bold mb-1">
        {{ emp.user.get_full_name|default:emp.user.username }}
        {% if profile.verified %}
          <span class="badge bg-success ms-2">Verified</span>
        {% else %}
          <span class="badge bg-warning text-dark ms-2">Pending</span>
        {% endif %}
      </h5>

      {% if managed_department %}
        <p class="text-primary fw-semibold mb-1">
          Manager of {{ managed_department.name }} Department
        </p>
      {% endif %}

      <p class="mb-1 text-muted">Employee ID: {{ emp.employee_id }}</p>
      <p class="text-muted small">{{ emp.designation }} — {{ emp.department }}</p>

      <a href="/employees/profile/" class="btn btn-outline-primary btn-sm mb-1">View More →</a>
    </div>
  </div>
</div>

<!-- Team Attendance Summary -->
<div class="card shadow-sm p-3 mb-4">
  <h6 class="fw-bold mb-2">Today's Team Attendance</h6>
  <p class="mb-1">
    <strong>Present:</strong> {{ present_count }} /
    <strong>Absent:</strong> {{ absent_count }} /
    <strong>Total:</strong> {{ total_team }}
  </p>
</div>

<h5 class="fw-bold mt-4 mb-3">Your Team Members</h5>
<div class="row text-center">

  <div class="col-md-6 mb-3">
    <div class="card shadow-sm border-0 h-100 bg-light">
      <div class="card-body d-flex flex-column justify-content-center">
        <h5 class="fw-semibold mb-2 text-primary">
          <i class="bi bi-clipboard-check me-1"></i> Team Attendance
        </h5>
        <p class="text-muted small mb-4">View today’s presence & monthly stats</p>
        <div>
          <a href="{% url 'attendance:manager_team' %}" class="btn btn-primary px-4">
            View Attendance
          </a>
        </div>
      </div>
    </div>
  </div>

  <div class="col-md-6 mb-3">
    <div class="card shadow-sm border-0 h-100 bg-light">
      <div class="card-body d-flex flex-column justify-content-center">
        <h5 class="fw-semibold mb-2 text-dark">
          <i class="bi bi-door-open me-1"></i> Team Leave Requests
        </h5>
        <p class="text-muted small mb-4">Review and approve leave applications</p>
        <div>
          <a href="{% url 'leaves:manager_list' %}" class="btn btn-dark px-4">
            Manage Requests
          </a>
        </div>
      </div>
    </div>
  </div>

</div>



<table class="table table-bordered table-striped">
  <thead>
    <tr>
      <th>Employee</th>
      <th>Designation</th>
      <th>Today</th>
      <th style="width: 160px;">Profile</th>
    </tr>
  </thead>
  <tbody>
    {% for member in team %}
    <tr>
      <td>{{ member.user.get_full_name|default:member.user.username }}</td>
      <td>{{ member.designation }}</td>
      <td>
        {% if member.is_present %}
          <span class="badge bg-success">Present</span>
        {% else %}
          <span class="badge bg-danger">Absent</span>
        {% endif %}
      </td>
      <td>
        <a href="{% url 'employees:view_profile' %}?emp={{ member.employee_id }}" 
   class="btn btn-sm btn-outline-primary w-100">
    View Profile
</a>

      </td>
    </tr>
    {% empty %}
    <tr>
      <td colspan="4" class="text-center">No team members in this department.</td>
    </tr>
    {% endfor %}
  </tbody>
</table>





{% endblock %}
